<!DOCTYPE html>
<html>
	<head>
		<!-- Standard Meta -->
	  <meta charset="utf-8" />
	  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	  <link rel="stylesheet" type="text/css" href="/assets/css/semantic.min.css">
		<script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="/assets/js/semantic.min.js"></script>
		<style type="text/css">
			.showByStatus {
				visibility: visible; 
			}
		</style>
	</head>
	<body>
		<div class="ui main container _smaller_margin_on_mobile">
		  <div class="ui page">
		  	<% if(error && error.length > 0) { %>
					<div class="ui black attached big red message">
					  <i class="close icon"></i>
					  <%= error %>
					</div>
				<% } %>
				<% if(success && success.length > 0) { %>
					<div class="ui success attached big green message">
					  <i class="close icon"></i>
					  <%= success %>
					</div>
				<% } %>
		  	<table class="ui large red table">
				  <thead>
				  	<tr style="vertical-align: center;">
				  		<th colspan="3">Pregled prijava za &nbsp;&nbsp;&nbsp;<div class="ui horizontal red label"><%= bussinessPartner %></div></th>
				  		<th colspan="4" class="right aligned">
				  			<div class="ui horizontal black large label">Korisnik - <%= currentUser %></div>
				  			<a class="ui inverted red button" href="/logout?forTicketing=true">Log out</a>
				  		</th>
					  </tr>
					  <tr>
				  		<th colspan="2">
				  			<a href="/tickets/new" id="idNewTicket" title="Napravi novu prijavu">
			  			<button class="ui labeled red icon button"><i class="right add icon"></i>Nova Prijava</button>
			  		</a>
				  		</th>
				  		<th colspan="3" class="right aligned"></th>
				  		<th colspan="2" class="right aligned">
				  			<div>
				  				<form class="ui form">
				  					<div class="inline fields">
				              <select id="ticketStatus" class="ui fluid dropdown">
				                <option value="All" selected>Prikazi sve prijave</option>
				                <option value="Evidentirano">Evidentirane prijave</option>
				                <option value="U radu">Prijave u radu</option>
				                <option value="Realizovano">Realizovane prijave</option>
				              </select>
				            </div>
			             </form>
				  			</div>
				  		</th>
					  </tr>
				    <tr class="center aligned">
				    	<th class="one wide">Prijava</th>
				    	<th class="two wide">Datum</th>
				    	<th class="six wide">Opis</th>
				    	<th class="three wide">Referenca</th>
				    	<th class="two wide">Tip Prijave</th>
				    	<th class="one wide">Prioritet</th>
				    	<th class="one wide">Status</th>
				  	</tr>
				  </thead>
				  <tbody>
			  		<% for (ticket of tickets) { %>
						    <tr class="center aligned">
						      <td><%= ticket.Broj %></td>
						      <td><%= moment(ticket.Datum).format('DD. MM. YYYY') %></td>
						      <td class="left aligned"><a style="color: red;" href="/tickets/<%= ticket.pk_id %>" id="idViewTicket" title="Pogledaj prijavu"><%= ticket.Subject %></a></td>
						      <td><%= ticket.Referenca %></td>
						      <td><%= ticket.TipPrijave %></td>
						      <td><%= ticket.Prioritet %></td>
						      <td><%= ticket.Status %></td>
						    </tr>
				 		<% } %>
				  </tbody>
				</table>
			</div>
		</div>
		<script>
			$(document).ready(() => {
				$('#ticketStatus').on('change', function() {
					var statusElem = this;
					$('tbody tr').each(function(idx, tr) {
						var tdStatus = $(tr).children().last().html();
						if(statusElem.value === "All" || statusElem.value === tdStatus) {
							$(this).toggle(true); // show
						} else {
							$(this).toggle(false);
						}
					});
				});

				$('.message .close').on('click', function() { $(this).closest('.message').transition('fade'); });
			});
		</script>
	</body>
</html>