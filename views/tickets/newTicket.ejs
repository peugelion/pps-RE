<!DOCTYPE html>
<html>
  <head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/assets/css/semantic.min.css">
    <script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/semantic.min.js"></script>
    <style type="text/css">
      .inputfile {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
      }
      .ui.form .inputfile + label {
        font-size: 1.25em;
        font-weight: 700;
        cursor: pointer;
        color: #fff;
        background-color: black;
        display: inline-block;
        width: 100%;
        text-align: center;
      }

      .ui.form .inputfile:focus + label {
        outline: 1px dotted #000;
        outline: -webkit-focus-ring-color auto 5px;
        background-color: #db2828;
      }

      .ui.form .inputfile + label:hover {
          background-color: #db2828;
      }

    </style>
  </head>
  <body>
    <div class="ui main container">
      <div class="ui page">
        <form class="ui form" method="POST" action="/tickets" id="theForm" enctype="multipart/form-data">
          <div class="fields">
            <div class="two wide field"></div>
            <div class="two wide field">
              <label>Broj</label>
              <input type="text" name="ticketNum" placeholder="Autogenerisan" readonly="readonly">
            </div>
            <div class="three wide field">
              <label>Datum</label>
              <input type="text" value="<%= ticketDate %>" readonly="readonly">
              <input type="hidden" name="ticketDate" value="<%= new Date(Date.now()).toISOString() %>">
            </div>
            <div class="seven wide field">
              <label>Poslovni Partner</label>
              <input type="text" name="ticketPP" placeholder="Partner" readonly="readonly" value="<%= namePP %>">
            </div>
            <div class="two wide field"></div>
          </div>
          <div class="fields">
            <div class="two wide field"></div>
            <div class="six wide field">
              <label>Tip prijave</label>
              <select name="ticketType" class="ui fluid dropdown">
                <!-- <option value="">---odaberite---</option> -->
                <option value="2234">Bug</option>
                <option value="2235" selected>Zahtev</option>
                <option value="2388">Kvar</option>
              </select>
            </div>
            <div class="six wide field">
              <label>Prioritet</label>
              <select name="ticketPriority" class="ui fluid dropdown">
                <!-- <option value="">---odaberite---</option> -->
                <option value="2236" selected>Normalan</option>
                <option value="2237">Hitno</option>
              </select>
            </div>
            <div class="two wide field">
            </div>
          </div>
          <div class="fields">
            <div class="two wide field"></div>
            <div class="twelve wide field">
              <label>Referenca</label>
              <input type="text" name="referenca" placeholder="Maksimum 50 karaktera...">
            </div>
            <div class="two wide field"></div>
          </div>
          <div class="fields">
            <div class="two wide field"></div>
            <div class="twelve wide field">
              <label>Opis prijave</label>
              <textarea name="ticketSubject"></textarea>
            </div>
            <div class="two wide field"></div>
          </div>
          <div class="fields">
            <div class="two wide field"></div>
            <div class="twelve wide field">
              <h5 class="ui dividing header">Dodajte fajl</h5>
              <div class="two wide field"></div>
            </div>
          </div>

          <!-- FILE ATTACHMENT FIELD -->
          <div class="fields">
            <div class="two wide field"></div>
            <div class="three wide field">
              <input type="file" name="attachedFile" id="attachedFile" class="inputfile" />
              <label for="attachedFile" class="ui big label">Odaberite fajl</label>
            </div>
            <div class="nine wide field">
              <div class="ui grey tag label" id="selectedFile">.doc  .jpg  .pdf<i class="delete icon"></i></div>
            </div>
            <div class="two wide field"></div>
          </div>
          <!-- END OF FILE ATTACHMENT FIELD -->

          <div class="fields">
            <div class="two wide field"></div>
            <div class="twelve wide field"><h5 class="ui dividing header"></h5></div>
          </div>
          <div class="fields">
            <div class="two wide field"></div>
            <div class="twelve wide field">
              <input type="submit" class="ui right floated red button" value="Sačuvaj" />
              <a id="getBack" class="ui right floated black button">Nazad</a>
            </div>
          </div>
        </form>
      </div>
    </div>
    <script type="text/javascript">
      $(document).ready(() => {
        document.getElementById('getBack').addEventListener('click', (e) => {
          window.history.go(-1);
        });

        $('select.dropdown').dropdown();

        var fileInput = document.querySelector('.inputfile');
        var label     = fileInput.nextElementSibling,
            labelVal  = label.innerHTML;

        fileInput.addEventListener('change', function( e ) {
          var fileName = '';
          if(this.files && this.files.length >= 1) {
            fileName = this.files[0].name;
          } else {
            fileName = e.target.value.split( '\\' ).pop();
          }

          if(fileName) {
            label.innerHTML = "Odabrali ste";
            var deleteIcon = document.querySelector('.label .delete');
            var span  = document.createElement('span');
            span.innerHTML = fileName;
            var filenameDiv = document.getElementById('selectedFile');
            filenameDiv.insertBefore(span, deleteIcon);
            filenameDiv.className = filenameDiv.className.replace(/transition|hidden/g, "");
          }
          else {
            document.getElementById('selectedFile').firstChild.remove(); 
            label.innerHTML = labelVal;
          }
        });

        $('.label .delete').on('click', function() { 
          $(this).closest('.label').transition('fade');
          fileInput.value = "";
          if ("createEvent" in document) {
            var evt = document.createEvent("HTMLEvents");
            evt.initEvent("change", false, true);
            fileInput.dispatchEvent(evt);
          } else {
            fileInput.fireEvent("onchange");
          }
        });

      });
    </script>
  </body>
</html>